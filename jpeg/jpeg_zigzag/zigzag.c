#include <stdint.h>
#include <stdio.h>
#if(__SSE3__ == 1)
#include <xmmintrin.h>
#include <emmintrin.h>
#endif
/*
#if(__SSSE3__ == 1)
inline void zigzag(__v8hi *one, __v8hi *two, __v8hi *three, __v8hi *four, __v8hi *five, __v8hi *six, __v8hi *seven, __v8hi *eight){
   const __v16qi
      a = *((__v16qi*)one),
      b = *((__v16qi*)two),
      c = *((__v16qi*)three),
      d = *((__v16qi*)four),
      e = *((__v16qi*)five),
      f = *((__v16qi*)six),
      g = *((__v16qi*)seven),
      h = *((__v16qi*)eight);
      const __v8hi zero = (__v8hi){0,0,0,0,0,0,0,0};
      *one = zero;
      *two = zero;
      *three = zero;
      *four = zero;
      *five = zero;
      *six = zero;
      *seven = zero;
      *eight = zero;

      //masks containing each vectors own elements, i.e. the ones that will remain with 
      //the vector                       0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf
      const __v16qi mask_a_1 = (__v16qi){0x0,0x1,0x2,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x4,0x5,0x6,0x7,0x0,0x0};
      const __v16qi mask_b_1 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x0,0x0,0x0,0x0};
      const __v16qi mask_c_1 = (__v16qi){0x0,0x0,0x6,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_d_1 = (__v16qi){0x6,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x8,0x9};
      const __v16qi mask_e_1 = (__v16qi){0x6,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x8,0x9};
      const __v16qi mask_f_1 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_g_1 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_h_1 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};

      const __v16qi mask_a_2 = (__v16qi){0x0,0x1,0x2,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x4,0x5,0x6,0x7,0x0,0x0};
      const __v16qi mask_b_2 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_c_2 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_d_2 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_e_2 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_f_2 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_g_2 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
      const __v16qi mask_h_2 = (__v16qi){0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};

      
      *one += *((__v8hi*)__builtin_ia32_pshufb128(a,mask_a_1));
      *two += *((__v8hi*)__builtin_ia32_pshufb128(b,mask_b_1));  
      *three += *((__v8hi*)__builtin_ia32_pshufb128(c,mask_c_1));     
      *four += *((__v8hi*)__builtin_ia32_pshufb128(d,mask_d_1));     
      *five += *((__v8hi*)__builtin_ia32_pshufb128(e,mask_e_1));     
      *six += *((__v8hi*)__builtin_ia32_pshufb128(f,mask_f_1));     
      *seven += *((__v8hi*)__builtin_ia32_pshufb128(g,mask_g_1));     
      *eight += *((__v8hi*)__builtin_ia32_pshufb128(h,mask_h_1));    


}
#endif
*/



//#if(__SSSE3__ == 0 )
inline void zigzag(short *one, short *two, short *three, short *four, short *five, short *six, short *seven, short *eight){
   short temp[8][8];
   short **input = (short**) alloca(8 * sizeof(short*));
   input[0] = one;
   input[1] = two;
   input[2] = three;
   input[3] = four;
   input[4] = five;
   input[5] = six;
   input[6] = seven;
   input[7] = eight;
   const uint16_t index[8][8] = 
   {
      {0x0000,0x0001,0x0100,0x0200,0x0101,0x0002,0x0003,0x0102},
      {0x0201,0x0300,0x0400,0x0301,0x0202,0x0103,0x0004,0x0006},
      {0x0104,0x0203,0x0302,0x0401,0x0500,0x0600,0x0501,0x0402},
      {0x0303,0x0204,0x0105,0x0006,0x0007,0x0106,0x0205,0x0304},
      {0x0403,0x0502,0x0601,0x0700,0x0701,0x0602,0x0503,0x0404},
      {0x0305,0x0206,0x0107,0x0207,0x0306,0x0405,0x0504,0x0603},
      {0x0702,0x0703,0x0604,0x0505,0x0406,0x0307,0x0407,0x0506},
      {0x0605,0x0704,0x0705,0x0606,0x0507,0x0607,0x0706,0x0707}
   };
   uint8_t x,y;
   for(x = 0; x < 8; x++){
      for(y = 0; y < 8; y++){
         const uint16_t i = index[x][y];
         temp[x][y] = input[i >> 8][i & 0xf];
      }
   }
   uint8_t i,j;
   for(i = 0; i < 8; i++){
      for(j = 0; j< 8; j++){
         input[i][j] = temp[i][j];
      }
   }
}
//#endif


inline void zigzag_array(short *one, short *two, short *three, short *four, short *five, short *six, short *seven, short *eight){

//#if(__SSSE3__ == 1)
//#ifdef DEBUG
  // fprintf(stderr,"SSSE3\n";
//#endif
//   zigzag(((__v8hi*)one),((__v8hi*) two),((__v8hi*) three),((__v8hi*) four),((__v8hi*)five),((__v8hi*) six),((__v8hi*) seven),((__v8hi*) eight));
//#endif

//#if(__SSSE3__ == 0)
//#ifdef DEBUG
//   fprintf(stderr,"NO SSE!!\n");
//#endif
   zigzag(one,two,three,four,five,six,seven,eight);
//#endif
}
